<!doctype html><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>BSS • Admin</title>
<style>
:root{--o:#ffa500;--b:#000}
html,body{margin:0;height:100%;background:var(--b);color:var(--o);font:16px/1.4 system-ui}
header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-bottom:2px solid var(--o)}
.badge{background:var(--o);color:#000;font-weight:900;padding:4px 8px;border-radius:8px}
button{border:2px solid var(--o);background:var(--o);color:#000;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
a.btn{border:2px solid var(--o);background:transparent;color:var(--o);border-radius:10px;padding:8px 12px;font-weight:700;text-decoration:none}
main{padding:20px;max-width:1080px;margin:auto}
.card{border:2px solid var(--o);border-radius:16px;padding:16px;margin:12px 0}
label{display:block;margin-top:8px}
input{width:100%;padding:10px;background:#000;color:#ffa500;border:2px solid var(--o);border-radius:10px}
.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
hr{border:0;border-top:2px solid var(--o);margin:12px 0}
</style>

<header>
  <div><span class="badge">BSS</span> <strong id="t_admin">Admin</strong></div>
  <div>
    <select id="langSel">
      <option value="en">EN</option>
      <option value="ht">Kreyòl</option>
      <option value="fr">FR</option>
    </select>
    <button id="out">Sign out</button>
  </div>
</header>

<main>
  <div class="card">
    <h2 id="t_dash">Dashboard</h2>
    <div class="row">
      <a class="btn" href="/admin/ti-machann" id="t_ti">Ti Machann Form</a>
      <a class="btn" href="/admin/contracts.html" id="t_contracts">Contracts</a>
      <a class="btn" href="/admin/transactions.html" id="t_tx">Transactions</a>
    </div>
  </div>

  <div class="card">
    <h3 id="t_badge_title">Vendor Badge Generator</h3>
    <div class="row">
      <div>
        <label id="t_fullname">Full Name</label>
        <input id="b_name">
      </div>
      <div>
        <label id="t_company">Company</label>
        <input id="b_company">
      </div>
      <div>
        <label id="t_vendorid">Vendor ID</label>
        <input id="b_id" placeholder="VM-0001">
      </div>
    </div>
    <hr>
    <button id="makePng">Generate PNG</button>
    <button id="makePdf">Generate PDF</button>
    <canvas id="badge" width="600" height="360" style="display:block;margin-top:12px;border:2px solid var(--o);border-radius:16px"></canvas>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
import jsPDF from "https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.es.min.js";

const firebaseConfig = { /* YOUR CONFIG */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --------- Guard: admins only ----------
onAuthStateChanged(auth, async (user) => {
  if (!user) return location.replace("/login");
  const adm = await getDoc(doc(db, "admins", user.uid));
  if (!adm.exists()) return location.replace("/login");
});

document.getElementById("out").onclick = () => signOut(auth).then(()=>location.replace("/login"));

// --------- i18n ----------
const strings = {
  en:{ Admin:"Admin",Dashboard:"Dashboard","Ti Machann Form":"Ti Machann Form",
       Contracts:"Contracts",Transactions:"Transactions","Vendor Badge Generator":"Vendor Badge Generator",
       "Full Name":"Full Name","Company":"Company","Vendor ID":"Vendor ID" },
  ht:{ Admin:"Administratè",Dashboard:"Tablo", "Ti Machann Form":"Fòm Ti Machann",
       Contracts:"Kontra",Transactions:"Transaksyon", "Vendor Badge Generator":"Jenere Badj Vandè",
       "Full Name":"Non konplè","Company":"Konpayi","Vendor ID":"ID Vandè" },
  fr:{ Admin:"Admin",Dashboard:"Tableau de bord","Ti Machann Form":"Formulaire Ti Machann",
       Contracts:"Contrats",Transactions:"Transactions","Vendor Badge Generator":"Générateur de badge vendeur",
       "Full Name":"Nom complet","Company":"Entreprise","Vendor ID":"ID Vendeur" }
};
const applyLang=(l)=>{
  const S=strings[l]||strings.en;
  document.getElementById("t_admin").textContent=S.Admin;
  document.getElementById("t_dash").textContent=S.Dashboard;
  document.getElementById("t_ti").textContent=S["Ti Machann Form"];
  document.getElementById("t_contracts").textContent=S.Contracts;
  document.getElementById("t_tx").textContent=S.Transactions;
  document.getElementById("t_badge_title").textContent=S["Vendor Badge Generator"];
  document.getElementById("t_fullname").textContent=S["Full Name"];
  document.getElementById("t_company").textContent=S.Company;
  document.getElementById("t_vendorid").textContent=S["Vendor ID"];
};
const sel=document.getElementById("langSel");
sel.onchange=()=>{ localStorage.setItem("bss_lang",sel.value); applyLang(sel.value); };
sel.value=localStorage.getItem("bss_lang")||"en"; applyLang(sel.value);

// --------- Badge Generator ----------
const canvas=document.getElementById("badge"), ctx=canvas.getContext("2d");
function drawBadge(){
  const name=document.getElementById("b_name").value||"Vendor Name";
  const comp=document.getElementById("b_company").value||"Company";
  const id=document.getElementById("b_id").value||"VM-0001";
  ctx.clearRect(0,0,600,360);
  ctx.fillStyle="#000"; ctx.fillRect(0,0,600,360);
  ctx.strokeStyle="#ffa500"; ctx.lineWidth=6; ctx.strokeRect(6,6,588,348);
  ctx.fillStyle="#ffa500";
  ctx.font="bold 28px system-ui"; ctx.fillText("BSS • VENDOR",22,48);
  ctx.font="bold 46px system-ui"; ctx.fillText(name,22,130);
  ctx.font="24px system-ui"; ctx.fillText(comp,22,170);
  ctx.font="bold 28px system-ui"; ctx.fillText(id,22,220);
  // mini badge block
  ctx.fillRect(22,260,140,70);
  ctx.fillStyle="#000"; ctx.font="bold 36px system-ui"; ctx.fillText("BSS",52,310);
}
["b_name","b_company","b_id"].forEach(id=>document.getElementById(id).addEventListener("input",drawBadge));
drawBadge();

document.getElementById("makePng").onclick=()=> {
  drawBadge();
  const url=canvas.toDataURL("image/png");
  const a=document.createElement("a"); a.href=url; a.download="badge.png"; a.click();
};
document.getElementById("makePdf").onclick=()=> {
  drawBadge();
  const pdf=new jsPDF({orientation:"landscape",unit:"px",format:[600,360]});
  pdf.addImage(canvas.toDataURL("image/png"),"PNG",0,0,600,360);
  pdf.save("badge.pdf");
};
</script>
