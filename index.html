<span class="bss-logo-wrap"><img src="/img/bss.png" alt="BSS"></span><svg class="bss-logo" width="34" height="24" viewBox="0 0 34 24" aria-label="BSS">
  <rect width="100%" height="100%" fill="#000000"/>
  <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"
        font-family="Inter, system-ui, sans-serif" font-weight="700"
        font-size="14" fill="#ff7a00">BSS</text>
</svg><span class="bss-badge">BSS</span><a class="btn" id="weeklyBtn" style="display:none" href="/api/audit-weekly-digest">Send Weekly Digest</a>
<script>
  (async ()=>{
    const user = await new Promise(r=>firebase.auth().onAuthStateChanged(u=>r(u)));
    if(!user) return;
    const tok = await user.getIdToken();
    const me = await fetch('/api/whoami',{ headers:{ Authorization:'Bearer '+tok }}).then(r=>r.json());
    if(me.ok && me.role==='super'){
      const b = document.getElementById('weeklyBtn');
      b.style.display='inline-flex';
      b.onclick = async (e)=>{
        e.preventDefault();
        await fetch('/api/audit-weekly-digest', { headers:{ Authorization:'Bearer '+tok }});
        alert('Weekly digest sent.');
      };
    }
  })();
</script><!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Audit Diff â€¢ Super Admin â€¢ BSS 1815</title>
<link rel="stylesheet" href="/css/base.css">
<style>
  :root { --orange:#ff7a00; --bg:#0a0a0a; --card:#111; }
  body{background:var(--bg);color:#f5f5f5;font-family:system-ui,Segoe UI,Roboto}
  header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#111;border-bottom:1px solid rgba(255,122,0,.25)}
  header img{height:32px}
  .wrap{max-width:900px;margin:16px auto;padding:0 12px}
  .card{background:#111;border:1px solid rgba(255,122,0,.35);border-radius:12px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .input{background:#000;border:1px solid #333;color:#fff;padding:10px;border-radius:10px}
  .btn{background:var(--orange);color:#000;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#222;color:#fff;border:1px solid #333}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border-bottom:1px solid #222;padding:10px;text-align:left}
  th{color:var(--orange)}
  .tag{padding:2px 8px;border-radius:8px;background:#1b1b1b;border:1px solid #333;color:#ddd;font-size:12px}
  .diff{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .box{background:#000;border:1px solid #333;border-radius:10px;padding:10px}
  .muted{color:#9a9a9a}
</style>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:10px">
    <img src="/logo.png" alt="BSS"><strong>Audit Diff â€¢ Super Admin</strong>
  </div>
  <div id="me" class="muted"></div>
</header>

<div class="wrap">
  <div class="card">
    <div class="row">
      <input id="uid" class="input" style="min-width:280px" placeholder="Target UID (the user you changed)">
      <button id="run" class="btn">Load Role History</button>
      <span id="status" class="muted"></span>
    </div>
    <div id="out" style="margin-top:12px"></div>
  </div>
</div>

<script>
  const firebaseConfig = { apiKey:"YOUR_API_KEY", authDomain:"YOUR_PROJECT.firebaseapp.com", projectId:"YOUR_PROJECT_ID" };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  let token = null;

  const $ = id=>document.getElementById(id);

  async function ensureSuper(){
    const user = await new Promise(r=>firebase.auth().onAuthStateChanged(u=>r(u)));
    if(!user){ location.href="/admin/login.html"; return false; }
    token = await user.getIdToken();
    const me = await fetch('/api/whoami', { headers:{ Authorization:'Bearer '+token }}).then(r=>r.json());
    if (!me.ok || me.role!=='super'){ document.body.innerHTML = "<div style='padding:24px;color:#ff7a00'>Super Admin only.</div>"; return false; }
    $("me").textContent = me.email + " â€¢ role: " + me.role;
    return true;
  }

  $("run").onclick = async ()=>{
    const uid = $("uid").value.trim();
    if(!uid){ $("status").textContent = "Enter a UID."; return; }
    $("status").textContent = "Loadingâ€¦";
    const res = await fetch('/api/audit-role-history', {
      method:'POST',
      headers: { 'Content-Type':'application/json', Authorization: 'Bearer '+token },
      body: JSON.stringify({ uid, limit: 50 })
    }).then(r=>r.json());
    if(!res.ok){ $("status").textContent = "Failed: "+(res.error||""); return; }
    $("status").textContent = "";
    render(res.items||[]);
  };

  function render(items){
    const out = $("out");
    if(!items.length){ out.innerHTML = "<div class='muted'>No role changes found.</div>"; return; }
    out.innerHTML = `
      <table>
        <thead><tr><th>When</th><th>Actor</th><th>Change</th></tr></thead>
        <tbody>
          ${items.map(x=>`
            <tr>
              <td>${x.at||""}</td>
              <td>${x.actorEmail||x.actorUid||""} <span class="tag">${x.actorRole||""}</span></td>
              <td>
                <div class="diff">
                  <div class="box"><strong>Before</strong><br>${x.prevRole ?? "â€”"}</div>
                  <div class="box"><strong>After</strong><br>${x.newRole ?? "â€”"}</div>
                </div>
              </td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    `;
  }

  (async ()=>{ await ensureSuper(); })();
</script>
</body>
</html><a class="btn" id="auditBtn" style="display:none" href="/admin/audit.html">Audit Log</a>
<script>
  (async ()=>{
    const user = await new Promise(r=>firebase.auth().onAuthStateChanged(u=>r(u)));
    if(!user) return;
    const tok = await user.getIdToken();
    const me = await fetch('/api/whoami', { headers:{ Authorization:'Bearer '+tok }}).then(r=>r.json());
    if(me.ok && me.role==='super') document.getElementById('auditBtn').style.display='inline-flex';
  })();
</script><a class="btn" href="/admin/checkins.html">Live Check-Ins</a><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>New Vendor â€¢ Admin â€¢ BSS 1815</title>
<link rel="stylesheet" href="/css/base.css">
<style>
  body{background:#0a0a0a;color:#f5f5f5}
  .wrap{max-width:980px;margin:24px auto}
  .row{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  label{color:#ff7a00;font-weight:800;margin:6px 0;display:block}
  .input,.ta,.sel{width:100%;background:#111;border:1px solid rgba(255,122,0,.35);color:#fff;padding:12px;border-radius:10px}
  .ta{min-height:120px;resize:vertical}
  .card{background:#111;border:1px solid rgba(255,122,0,.35);border-radius:12px;padding:16px;margin-top:16px}
  .btn{background:#ff7a00;color:#000;border:0;border-radius:10px;padding:10px 14px;font-weight:800}
  .btn.secondary{background:#222;color:#fff;border:1px solid #333}
  small.muted{color:#9a9a9a}
</style>

<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
    <div style="display:flex;align-items:center;gap:10px">
      <img src="/logo.png" style="height:36px" alt="BSS">
      <h2 style="margin:0">Ti Machann â€¢ New</h2>
    </div>
    <div style="display:flex;gap:8px">
      <a class="btn secondary" href="/admin/vendors.html">Back to List</a>
    </div>
  </div>

  <form id="form" class="card">
    <input type="hidden" id="docId">
    <div class="row">
      <div>
        <label>Vendor Name *</label>
        <input class="input" id="name" required>
      </div>
      <div>
        <label>Company</label>
        <input class="input" id="company">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Email *</label>
        <input class="input" id="email" type="email" required>
      </div>
      <div>
        <label>Phone (required) *</label>
        <input class="input" id="phone" placeholder="+1 555 123 4567" required>
      </div>
      <div>
        <label>Alt Phone</label>
        <input class="input" id="phone2">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Category / Goods</label>
        <input class="input" id="category" placeholder="Food, Apparel, Drinksâ€¦">
      </div>
      <div>
        <label>Vendor ID</label>
        <input class="input" id="vid" placeholder="VM-0001">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Address</label>
        <input class="input" id="address">
      </div>
      <div>
        <label>Social / Website</label>
        <input class="input" id="social">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Emergency Contact (name/phone)</label>
        <input class="input" id="emergency">
      </div>
      <div>
        <label>Tax ID (if any)</label>
        <input class="input" id="taxid">
      </div>
    </div>

    <div>
      <label>Notes</label>
      <textarea class="ta" id="notes"></textarea>
    </div>

    <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
      <button type="button" class="btn" id="saveBtn">Save Draft</button>
      <button type="button" class="btn" id="finalizeBtn">Finalize â†’ PDF + Email</button>
      <span id="status" class="muted" style="align-self:center"></span>
    </div>
    <small class="muted">Saving as Draft stores data in Firestore. Finalizing generates a logoâ€™d PDF and emails admins; status becomes Finalized.</small>
  </form>
</div>

<script>
  // 1) Firebase init (use your real keys via inline constants or injected)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const $ = (id)=>document.getElementById(id);
  const fields = ["name","company","email","phone","phone2","category","vid","address","social","emergency","taxid","notes"];

  function getFormData(){
    const d = {};
    fields.forEach(f => d[f] = $(f).value.trim());
    d.status = "Draft";
    d.updatedAt = new Date().toISOString();
    return d;
  }

  async function saveDraft(){
    const status = $("status");
    status.textContent = "Savingâ€¦";
    const data = getFormData();
    if (!data.name || !data.email || !data.phone){
      status.textContent = "Name, Email, and Phone are required.";
      return;
    }
    data.status = "Draft";
    data.createdAt = data.createdAt || new Date().toISOString();

    let id = $("docId").value;
    try{
      if (id){
        await db.collection("vendors").doc(id).set(data, { merge:true });
      } else {
        const doc = await db.collection("vendors").add(data);
        id = doc.id;
        $("docId").value = id;
      }
      status.textContent = "Draft saved.";
    }catch(e){
      console.error(e);
      status.textContent = "Error saving draft.";
    }
  }

  async function finalize<script>
  // Build a simple PDF locally (client-side) for instant download
  async function downloadContractPDF(formData) {
    const { PDFDocument, StandardFonts, rgb } = PDFLib;
    const pdfDoc = await PDFDocument.create();
    const page = pdfDoc.addPage([612, 792]); // Letter
    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
    const fontBold = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

    // helpers
    let y = 752, left = 50, maxWidth = 512, lh = 14;
    const write = (txt, bold=false) => {
      const f = bold ? fontBold : font;
      const words = (txt || "").toString().split(" ");
      let line = "";
      for (const w of words) {
        const test = line ? line + " " + w : w;
        if (f.widthOfTextAtSize(test, 10) > maxWidth) {
          page.drawText(line, { x:left, y, size:10, font:f, color:rgb(1,1,1) }); y -= lh;
          line = w;
        } else { line = test; }
      }
      if (line) { page.drawText(line, { x:left, y, size:10, font:f, color:rgb(1,1,1) }); y -= lh; }
    };
    const section = (h, v) => { write(h, true); if (v) write(v); y -= 6; }

    // title
    page.drawText("MUSICIAN PERFORMANCE AGREEMENT â€” BSS 1815", {
      x:left, y, size:14, font:fontBold, color:rgb(1, 0.48, 0)
    }); y -= 22;

    const t = s => (s ?? "").toString().trim();

    section("Parties",
      `Presenter: ${t(formData.presenter_name)} | ${t(formData.presenter_email)} | ${t(formData.presenter_phone)}\n` +
      `Artist: ${t(formData.artist_name)} | ${t(formData.artist_email)} | ${t(formData.artist_phone)}`
    );
    section("Engagement",
      `Event: ${t(formData.event_name)}  Date: ${t(formData.event_date)}  Venue: ${t(formData.venue)}  Capacity: ${t(formData.capacity) || "-"}`);
    section("Schedule",
      `Load-in: ${t(formData.loadin) || "-"}  Soundcheck: ${t(formData.soundcheck) || "-"}  Performance: ${t(formData.performance_window) || "-"}`);
    section("Sets/Breaks",
      `Sets: ${t(formData.sets) || "-"}  Breaks: ${t(formData.breaks) || "-"}`);
    section("Compensation",
      `Fee: $${t(formData.fee)}  Deposit: $${t(formData.deposit) || "0"} (due: ${t(formData.deposit_due) || "-"})  ` +
      `Balance: ${t(formData.balance_due) || "-"}  Method: ${t(formData.payment_method)}`);
    section("Tech/Hospitality",
      `Gear: ${t(formData.gear) || "-"}\nSound/Light: ${t(formData.sound_light) || "-"}\nStage Plot: ${t(formData.stage_plot) || "-"}\nHospitality: ${t(formData.hospitality) || "-"}`);
    section("Legal",
      `Law: ${t(formData.law) || "-"}  Jurisdiction: ${t(formData.jurisdiction) || "-"}`);
    section("Signatories",
      `Presenter: ${t(formData.presenter_sign_name)}  |  Artist: ${t(formData.artist_sign_name)}`);

    const pdfBytes = await pdfDoc.save();
    const blob = new Blob([pdfBytes], { type: "application/pdf" });
    const url = URL.createObjectURL(blob);
    const cleanArtist = t(formData.artist_name).replace(/\s+/g,'_') || "Artist";
    const cleanDate = t(formData.event_date).replace(/[^\d]/g,'') || "date";
    const filename = `BSS_Musician_Agreement_${cleanArtist}_${cleanDate}.pdf`;

    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 750);
  }

  // Submit to serverless + download PDF
  const form = document.getElementById('bssContract');
  const statusEl = document.getElementById('contractStatus');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    statusEl.textContent = "Submittingâ€¦";
    const data = Object.fromEntries(new FormData(form).entries());

    if(!data.presenter_phone || !data.artist_phone){
      statusEl.textContent = "Phone numbers are required for both parties.";
      return;
    }

    try {
      // 1) Send to your Vercel API (emails + server-generated PDF)
      const res = await fetch('/api/contract', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)
      });
      const out = await res.json();
      if(!out.ok) throw new Error(out.error || 'Error');

      // 2) Download a local copy immediately for the submitter
      await downloadContractPDF(data);

      statusEl.textContent = "Sent! Emails delivered and PDF downloaded.";
      form.reset();
    } catch (err) {
      console.error(err);
      statusEl.textContent = "There was a problem. Please try again.";
    }
  });
</script><script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script><a href="/contracts/Musician_Performance_Agreement_BSS1815.pdf" target="_blank">Musician Contract (PDF)</a><script>
  const form = document.getElementById('bssForm');
  const statusEl = document.getElementById('bssStatus');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    statusEl.textContent = "Voye mesaj laâ€¦";
    const data = Object.fromEntries(new FormData(form).entries());

    try {
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(data)
      });
      const out = await res.json();
      if (!out.ok) throw new Error(out.error || 'Error');
      statusEl.textContent = "MÃ¨si! Mesaj la rive. Nou ap reponn ou byento.";
      form.reset();
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Gen yon pwoblÃ¨m. Eseye ankÃ² sâ€™il vous plaÃ®t.";
    }
  });
</script><section class="section">
  <div class="container">
    <h2 style="color:#ff7a00;margin:0 0 8px">Voye Mesaj la</h2>
    <p class="muted">Nou reponn vit. (BSS ðŸŸ âš«)</p>

    <form id="bssForm" class="card" style="margin-top:12px">
      <div class="row">
        <div>
          <label>Non konplÃ¨</label>
          <input class="input" name="name" required>
        </div>
        <div>
          <label>ImÃ¨l</label>
          <input class="input" name="email" type="email" required>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label>TelefÃ²n</label>
          <input class="input" name="phone" placeholder="+1 317 538 1150">
        </div>
        <div>
          <label>SijÃ¨</label>
          <input class="input" name="subject" placeholder="Kisa li ye?" required>
        </div>
      </div>
      <div style="margin-top:12px">
        <label>Mesaj</label>
        <textarea class="input" name="message" rows="5" required></textarea>
      </div>
      <div style="margin-top:16px">
        <button class="btn-primary" style="padding:12px 16px;border:0;border-radius:12px">Voye Mesaj â†’</button>
      </div>
      <p id="bssStatus" class="muted" style="margin-top:10px"></p>
    </form>
  </div>
</section><script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

<script>
  // 1) Firebase init
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // 2) Form submit â†’ Firestore + call email function endpoint
  const form = document.getElementById('bssForm');
  const statusEl = document.getElementById('bssStatus');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());
    data.createdAt = new Date().toISOString();

    statusEl.textContent = "Voye mesaj laâ€¦";
    try {
      // Save to Firestore
      await db.collection('fan_messages').add(data);

      // Call serverless email sender
      await fetch("https://YOUR_REGION-YOUR_PROJECT.cloudfunctions.net/bssSendMail", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });

      statusEl.textContent = "MÃ¨si! Mesaj la rive. Nou ap reponn ou byento.";
      form.reset();
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Gen yon pwoblÃ¨m. Eseye ankÃ² sâ€™il vous plaÃ®t.";
    }
  });
</script><section class="section">
  <div class="container">
    <h2 style="color:#ff7a00;margin:0 0 8px">Voye Mesaj la</h2>
    <p class="muted">Nou reponn vit. (BSS ðŸŸ âš«)</p>

    <form id="bssForm" class="card" style="margin-top:12px">
      <div class="row">
        <div>
          <label>Non konplÃ¨</label>
          <input class="input" name="name" required>
        </div>
        <div>
          <label>ImÃ¨l</label>
          <input class="input" name="email" type="email" required>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label>TelefÃ²n</label>
          <input class="input" name="phone" placeholder="+1 317 538 1150">
        </div>
        <div>
          <label>SijÃ¨</label>
          <input class="input" name="subject" placeholder="Kisa li ye?" required>
        </div>
      </div>
      <div style="margin-top:12px">
        <label>Mesaj</label>
        <textarea class="input" name="message" rows="5" required></textarea>
      </div>
      <div style="margin-top:16px">
        <button class="btn-primary" style="padding:12px 16px;border:0;border-radius:12px">Voye Mesaj â†’</button>
      </div>
      <p id="bssStatus" class="muted" style="margin-top:10px"></p>
    </form>
  </div>
  </section><!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>BRIYANT SOLEY SIGNO 1815</title>
<link rel="stylesheet" href="css/base.css">
</head><body>

<!-- header -->
<header class="header">
  <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:16px;">
    <a class="brand" href="index.html"><span class="dot"></span><span>BRIYANT SOLEY SIGNO 1815</span></a>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="leaders.html">Leaders</a>
      <a href="videos.html">Video&nbsp;Gallery</a>
      <a href="store.html">Store</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1 style="margin:0 0 12px;font-size:40px;letter-spacing:.03em;">Bold. Orange + Black.</h1>
    <p>Site is live â€” fast static setup on Vercel. Uniform orange links, black background, no white UI.</p>
    <p><a class="btn-primary" href="videos.html" style="padding:12px 16px;border-radius:12px;display:inline-block">Watch</a></p>
  </div>
</section>

<section class="section">
  <div class="container grid cols-2">
    <article class="card"><h3>Merch & Apparel</h3><p>Quality pieces in the signature orange + black palette.</p><p><a href="store.html">Shop now â†’</a></p></article>
    <article class="card"><h3>Video Gallery</h3><p>Clips, highlights, and promos â€” all in one place.</p><p><a href="videos.html">Explore videos â†’</a></p></article>
    <article class="card"><h3>Leaders</h3><p>Profiles and shoutouts to the team behind the brand.</p><p><a href="leaders.html">Meet the leaders â†’</a></p></article>
    <article class="card"><h3>About</h3><p>The story, the mission, the vision.</p><p><a href="about.html">Learn more â†’</a></p></article>
  </div>
</section>

<footer class="footer">
  <div class="container" style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px;">
    <small class="muted">Â© 2025 Briyant Soley Signo 1815. All rights reserved.</small>
    <small class="muted">Email: <a href="mailto:briyantsoleysigno1815@gmail.com">briyantsoleysigno1815@gmail.com</a></small>
  </div>
</footer>

<script>
const path = location.pathname.split('/').pop() || 'index.html';
document.querySelectorAll('.nav a').forEach(a=>{ if(a.getAttribute('href')===path){a.classList.add('active')} });
</script>
</body></html>
